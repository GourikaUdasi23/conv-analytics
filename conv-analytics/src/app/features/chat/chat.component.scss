:host {
  display: block;
  height: 100%;
}

.chat-layout {
  height: 100%;
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: 16px;
  padding: 12px;
  box-sizing: border-box;
}

.left-col {
  background: var(--left-bg);
  border-radius: 8px;
  padding: 8px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  min-height: 0;
}

.left-header {
  position: sticky;
  top: 8px;
  z-index: 2;
}



.convo-list {
  overflow: auto;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.convo-item {
  display: flex;
  align-items: center;
  padding: 8px;
  border-radius: 6px;
  cursor: pointer;
  transition: background .12s ease, transform .06s ease;
}
.convo-item:hover { background: rgba(0,0,0,0.04); transform: translateY(-1px); }
.convo-item.active { background: var(--accent-soft); }
.convo-item { gap: 8px; }
.convo-item .avatar { width:36px; height:36px; border-radius:50%; background: linear-gradient(135deg, rgba(255,255,255,0.85), var(--bubble-bot-start)); display:flex; align-items:center; justify-content:center; font-weight:700; color: var(--bubble-bot-text); flex: 0 0 auto; }
.convo-item .meta { flex: 1 1 auto; min-width: 0; }
.convo-item .title { font-weight: 600; margin-bottom: 4px; font-size: 14px; }
.convo-item .preview { font-size: 12px; opacity: .75; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; line-clamp: 2; }
.convo-item .time { font-size: 11px; opacity: .6; margin-left: 8px; flex: 0 0 auto; }
.convo-item .actions { margin-left: 8px; }
.empty { padding: 12px; color: var(--muted); }

.main-col {
  background: var(--main-bg);
  border-radius: 8px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.messages {
  flex: 1 1 auto;
  overflow: auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding-right: 8px;
}

/* prevent horizontal overflow for whole chat layout */
.chat-layout, .left-col, .main-col { overflow-x: hidden; }
.bubble {
  max-width: clamp(220px, 56%, 820px);
  border-radius: 20px;
  padding: 12px 16px;
  line-height: 1.5;
  box-shadow: 0 12px 30px rgba(8,12,20,0.06);
  word-wrap: break-word;
  white-space: pre-wrap;
  display: block;
}
.bubble.user { align-self: flex-end; background: linear-gradient(135deg,var(--bubble-user-start),var(--bubble-user-end)); color: var(--bubble-user-text); }
.bubble.bot { align-self: flex-start; background: linear-gradient(135deg,var(--bubble-bot-start),var(--bubble-bot-end)); color: var(--bubble-bot-text); }

.bubble-row { display:flex; gap:10px; align-items:flex-end; }
.avatar-sm { width:34px; height:34px; border-radius:50%; background:linear-gradient(135deg,rgba(255,255,255,0.9),var(--bubble-bot-start)); display:flex; align-items:center; justify-content:center; font-weight:700; color:var(--bubble-bot-text); flex:0 0 auto; }
.bubble-content { display:flex; flex-direction:column; }
.bubble-content .text { white-space:pre-wrap; }
.bubble-content .meta { font-size:11px; opacity:.65; margin-top:6px; }

/* apply entrance animation utility */
.msg-animate { animation: fadeInUp .36s cubic-bezier(.2,.9,.2,1); }

.bubble .meta { display: block; font-size: 11px; opacity: .65; margin-top: 6px; }

.messages::-webkit-scrollbar { width: 10px; }
.messages::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.08); border-radius: 6px; }

.empty-main { color: var(--muted); margin-top: 40px; }

.composer { padding-top: 6px; }
.error { color: var(--danger); margin-top: 6px; }

/* Ensure the composer input is readable in both light and dark themes */
.composer {
  /* input text color should follow card/text variable for good contrast */
  input.mat-input-element {
    color: var(--card-text) !important;
  }

  /* placeholder should use muted variable for subtle contrast */
  input.mat-input-element::placeholder {
    color: var(--muted) !important;
    opacity: 1;
  }

  /* mat-label (floating label) should be subtle but readable */
  .mat-form-field-label {
    color: var(--muted) !important;
  }

  /* ensure the send icon in the suffix is visible */
  button.mat-icon-button.matSuffix .mat-icon {
    color: var(--toolbar-icon-color) !important;
  }
}

/* Stronger dark-theme overrides: ensure input text and placeholder are readable */
.dark-theme .composer {
  input.mat-input-element {
    /* force pure white typed text in dark mode for maximum readability */
    color: #ffffff !important;
    caret-color: var(--card-text) !important;
  }

  /* slightly brighter placeholder in dark mode */
  input.mat-input-element::placeholder {
    color: rgba(230,238,248,0.8) !important; /* near --card-text but slightly muted */
    opacity: 1;
  }

  /* floating label and outline should also be visible */
  .mat-form-field-label {
    color: rgba(230,238,248,0.9) !important;
  }

  .mat-form-field-appearance-outline .mat-form-field-outline {
    border-color: rgba(230,238,248,0.06) !important;
  }

  button.mat-icon-button.matSuffix .mat-icon {
    color: var(--card-text) !important;
  }
}

/* Deeper overrides to ensure Material's internal selectors don't override our color
   This targets the actual input element used by matInput and related wrappers. */
:host ::ng-deep .mat-form-field .mat-input-element,
:host ::ng-deep .mat-form-field .mat-form-field-infix input.mat-input-element,
:host ::ng-deep input.mat-input-element {
  color: var(--card-text) !important;
  caret-color: var(--card-text) !important;
}

/* Specifically ensure dark-theme variant via a global class on body */
.dark-theme :host ::ng-deep .mat-form-field .mat-input-element,
.dark-theme :host ::ng-deep .mat-form-field .mat-form-field-infix input.mat-input-element {
  color: #ffffff !important;
  caret-color: #ffffff !important;
}

/* Make placeholder very readable in dark mode as a final fallback */
:host ::ng-deep input.mat-input-element::placeholder {
  color: rgba(230,238,248,0.9) !important;
  opacity: 1;
}

/* FINAL dark mode fix for input text visibility */
.dark-theme input.mat-input-element,
.dark-theme .mat-form-field .mat-input-element,
.dark-theme .mat-form-field .mat-form-field-infix input.mat-input-element {
  color: #ffffff !important;        /* make user-typed text white */
  caret-color: #ffffff !important;  /* make cursor white */
}

/* make placeholder text readable but slightly dimmer */
.dark-theme input.mat-input-element::placeholder {
  color: rgba(230, 238, 248, 0.8) !important;
  opacity: 1;
}


@media (max-width: 820px) {
  .chat-layout { grid-template-columns: 1fr; }
  .left-col { order: 2; }
  .main-col { order: 1; }
}

